# 并行MergeSort

目标：

int空间是4B， 10亿行（10^9），大小空间是4GB，加上mergesort的辅助空间， 需要8GB。

那么，100亿行，大小空间是40GB，加上mergesort的辅助空间， 需要80GB。现代的普通服务器，也基本都能满足。





思路：

尽量先按cpu 核数作为，线程数，排序自己负责的一部分数据据。合并任务数=sort线程数-1。

这里，sort线程数也可以配置超过物理cpu核数，但是过多线程数应该反而性能过低。



测试性能：

100M 行的int排序，400MB， 在2CPU的虚拟机环境下

单线程： `1thread, 400MB(100M), 16.4s,  6M/s`

2线程：`400MB, 100M, 10.6s, 9.4M/s`

10线程：`400MB, 100M, 23.5s, 4.2M/s`

大致符合预期，并行merge sort版本，由于实现问题：

- 通过主线程每隔10ms，对完成任务加锁，检查任务完成情况，进行merge
- 每次merge各子线程时从临时空间，再复制回原来的数组，带来额外O(2N) 复制时间
- 线程间的上下文切换带来开销

